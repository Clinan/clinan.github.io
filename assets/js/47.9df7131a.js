(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{490:function(t,s,a){"use strict";a.r(s);var e=a(10),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"mysql中学到的知识"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql中学到的知识"}},[t._v("#")]),t._v(" MySQL中学到的知识")]),t._v(" "),a("h2",{attrs:{id:"exists的使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#exists的使用"}},[t._v("#")]),t._v(" exists的使用")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("MySQL中exists除了if exists之外，还有where exists作为判断条件的用法")])]),t._v(" "),a("h3",{attrs:{id:"要求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#要求"}},[t._v("#")]),t._v(" 要求")]),t._v(" "),a("p",[t._v("筛选出aa的从表bb，存在2条及两条以上,且b_index不同的记录，且不能合并")]),t._v(" "),a("h3",{attrs:{id:"数据展示"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据展示"}},[t._v("#")]),t._v(" 数据展示")]),t._v(" "),a("h4",{attrs:{id:"aa表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#aa表"}},[t._v("#")]),t._v(" aa表")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.clinan.xyz/mysql_learn_1.png",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"bb表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#bb表"}},[t._v("#")]),t._v(" bb表")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.clinan.xyz/mysql_learn_2.png",alt:""}})]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("b_index\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" aa a\n         "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("left")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("join")]),t._v(" bb b "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("on")]),t._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("a_id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"https://cdn.clinan.xyz/mysql_learn_3.png",alt:""}})]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("count")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" coun"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("b_index\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" aa a\n         "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("left")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("join")]),t._v(" bb b "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("on")]),t._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("a_id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("group")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"https://cdn.clinan.xyz/mysql_learn_4.png",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"法1"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#法1"}},[t._v("#")]),t._v(" 法1")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("b_index\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" aa a\n         "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("left")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("join")]),t._v(" bb b "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("on")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("a_id\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("in")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" a_id\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n             "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("count")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" cou"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" a_id\n             "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" bb\n             "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("group")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" a_id\n         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" tmp\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" tmp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cou "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"https://cdn.clinan.xyz/mysql_learn_5.png",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"法2-where-exists"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#法2-where-exists"}},[t._v("#")]),t._v(" 法2(where exists)")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("b_index\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" aa a\n         "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("left")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("join")]),t._v(" bb b "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("on")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("a_id\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("exists")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" bb eb "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" eb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("b_index "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("b_index "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" eb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("a_id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"https://cdn.clinan.xyz/mysql_learn_6.png",alt:""}})]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("where exist中只要有返回值，无论是什么内容，返回就会判断这条数据通过where条件，从而保留这条数据。exists返回的结果集是空的话，则不能通过where判断，然后被where过滤掉。")])]),t._v(" "),a("h2",{attrs:{id:"mysql-between-and的边界问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql-between-and的边界问题"}},[t._v("#")]),t._v(" MySQL between and的边界问题")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n         "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("value")]),t._v("\n         "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("union")]),t._v("\n         "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("value")]),t._v("\n         "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("union")]),t._v("\n         "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("value")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" a\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("value")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("between")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("and")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n")])])]),a("p",[t._v("答案是显而易见的\n"),a("img",{attrs:{src:"https://cdn.clinan.xyz/mysql_learn_7.png",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"多表联查-逗号联查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#多表联查-逗号联查"}},[t._v("#")]),t._v(" 多表联查 逗号联查")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("在读sql的时候看到 "),a("code",[t._v("select * from aa a,bb b")]),t._v(",不理解是什么样的数据形式。")])]),t._v(" "),a("p",[a("strong",[t._v("aa,bb表的表数据如上面的截图")])]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" bid\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" aa a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n     bb b\n")])])]),a("p",[a("img",{attrs:{src:"https://cdn.clinan.xyz/mysql_learn_8.png",alt:""}})]),t._v(" "),a("ul",[a("li",[t._v("查询结果是一个aa,bb的笛卡尔积，即aa x bb")]),t._v(" "),a("li",[t._v("aa表的每一条数据都去左连接bb表的所有数据。")]),t._v(" "),a("li",[t._v("结果一共有(aa表的条数乘以bb表的条数)条")])]),t._v(" "),a("h2",{attrs:{id:"mysql查询分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql查询分析"}},[t._v("#")]),t._v(" MYSQL查询分析")]),t._v(" "),a("p",[a("code",[t._v("show profiles;")])]),t._v(" "),a("p",[a("code",[t._v("show profile for query 45;")])]),t._v(" "),a("h2",{attrs:{id:"尽量避免使用null值"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#尽量避免使用null值"}},[t._v("#")]),t._v(" 尽量避免使用NULL值")]),t._v(" "),a("p",[t._v("如果查询中包含可为NULL的列，对Mysql来说更难优化，因为可为NULL的列使得索引、索引统计和值比较都更复杂。\n可为NULL的列会使用更多的存储空间，在MySql里也需要特殊处理。当可为NULL的列被索引时，每个索引记录需要一个额外的字节。\n通常把可为NULL的列改为NOT NULL带来的性能提升比较小。但是如果计划在列上建立索引，就应该尽量避免设计成为可为NULL的列.")]),t._v(" "),a("h2",{attrs:{id:"关于varchar-text-等的使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关于varchar-text-等的使用"}},[t._v("#")]),t._v(" 关于varchar text 等的使用")]),t._v(" "),a("p",[t._v("应该尽量避免磁盘内存表\n"),a("img",{attrs:{src:"https://cdn.clinan.xyz/mysql_learn_9.png",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"innodb-mvcc多版本控制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#innodb-mvcc多版本控制"}},[t._v("#")]),t._v(" InnoDB MVCC多版本控制")]),t._v(" "),a("p",[t._v("在内部,InnoDB向每一行数据添加三个字段")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("字段名")]),t._v(" "),a("th",[t._v("占用空间")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("DB_TRX_ID")]),t._v(" "),a("td",[t._v("6字节")]),t._v(" "),a("td",[t._v("插入或更新该行的最后一个事务的事务标识符。删除在内部被视为更新，该行中的特殊位被设置为将其标记为已删除。")])]),t._v(" "),a("tr",[a("td",[t._v("DB_ROLL_PTR")]),t._v(" "),a("td",[t._v("7字节")]),t._v(" "),a("td",[t._v("回滚指针,回滚指针指向回滚段的撤销日志记录")])]),t._v(" "),a("tr",[a("td",[t._v("DB_ROW_ID")]),t._v(" "),a("td",[t._v("6 字节")]),t._v(" "),a("td",[t._v("包含一个行ID，该行ID随着插入新行而单调增加")])])])]),t._v(" "),a("p",[t._v("关于删除, innodb并不会立即物理删除记录, 而是在丢弃为这个删除而编写的回滚日志记录的时候,才会物理删除行及行索引"),a("br"),t._v("\n在同一事务中,对于同一个表,一边进行插入一边进行删除,则占用的表空间会越来越大.")]),t._v(" "),a("h3",{attrs:{id:"二级索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二级索引"}},[t._v("#")]),t._v(" 二级索引")]),t._v(" "),a("p",[t._v("更新, 对旧的索引进行删除标记, 插入新的值得索引.并在删除记录的时候,删除已标记删除的二级索引.\n如果第二个事务删除了索引,则会根据主键索引查找数据.")]),t._v(" "),a("h2",{attrs:{id:"锁"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#锁"}},[t._v("#")]),t._v(" 锁")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("共享锁（S），针对同一个数据，可以被多个会话读取（select ... for share）")])]),t._v(" "),a("li",[a("p",[t._v("排他锁（X），针对同一个数据，在没有完成之前，会阻塞其他会话的读写操作（select ... for update）")])]),t._v(" "),a("li",[a("p",[t._v("意向读锁（IS），一个事务要获取S锁之前，必须要获得IS锁或者更高级别（S,X,IX）的锁。")])]),t._v(" "),a("li",[a("p",[t._v("意向读锁（IX），一个事务要获得X锁之前，必须要获得IX锁或者更高级别（X）的锁。")])]),t._v(" "),a("li",[a("p",[t._v("记录锁(行锁)：锁定某一行")])]),t._v(" "),a("li",[a("p",[t._v("间隙锁(gap lock): 不锁定记录，只是锁定记录之间的间隙.（锁定一个范围，但是不包括记录本身）")])]),t._v(" "),a("li",[a("p",[t._v("下一键锁(next-key lock): 锁定一个范围，包括记录本身。")])])]),t._v(" "),a("p",[t._v("假定索引包含值10、11、13和20。此索引的可能的下一键锁定涵盖以下间隔，其中，圆括号表示排除区间端点，方括号表示包括端点：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("(negative infinity, 10]\n(10, 11]\n(11, 13]\n(13, 20]\n(20, positive infinity)\n")])])]),a("ul",[a("li",[t._v("自增锁（Auto-INC lock），自增锁是一个特殊的表级别的锁。当一个事务插入数据到有AUTO_INCREMENT列的表时，其他会话的插入数据需要等待第一个会话插入完成，以便于第一个会话获得连续的自增列")])]),t._v(" "),a("h2",{attrs:{id:"explain"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#explain"}},[t._v("#")]),t._v(" "),a("a",{attrs:{href:"https://dev.mysql.com/doc/refman/8.0/en/explain-output.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("explain"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("效率从高到低")]),t._v(" "),a("h4",{attrs:{id:"type"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#type"}},[t._v("#")]),t._v(" TYPE")]),t._v(" "),a("ol",[a("li",[t._v("system\n"),a("ul",[a("li",[t._v("查询的表只有一行，这是"),a("code",[t._v("const")]),t._v("类型的特例")])])]),t._v(" "),a("li",[t._v("const\n"),a("ul",[a("li",[t._v("该表最多具有一个匹配行，该行在查询开始时读取。因为只有一行，所以优化器的其余部分可以将这一行的列的值视为常量，const非常快，因为它只读取一次")])])]),t._v(" "),a("li",[t._v("eq_ref\n"),a("ul",[a("li",[t._v("连表使用索引的所有部分并且索引为"),a("code",[t._v("PRIMARY KEY")]),t._v("或"),a("code",[t._v("UNIQUE NOT NULL")]),t._v("时。一般是主键索引和唯一索引全部匹配时会出现")])])]),t._v(" "),a("li",[t._v("ref\n"),a("ul",[a("li",[t._v("如果不是主键索引或全部匹配的唯一索引，换句话说，就是使用了索引，但是索引匹配到的值不是一行，那么就是"),a("code",[t._v("ref")])])])]),t._v(" "),a("li",[t._v("fulltext 使用FULLTEXT索引进行join")]),t._v(" "),a("li",[t._v("ref_or_null\n"),a("ul",[a("li",[t._v("类似"),a("code",[t._v("ref")]),t._v("，但是除了MySQL对包含NULL值的行进行了额外的搜索之外。最常出现在解析子查询，如"),a("code",[t._v("select * from ref_table where column or column is NULL")]),t._v(".")])])]),t._v(" "),a("li",[t._v("index_merge\n"),a("ul",[a("li",[t._v("合并索引，key列会输出所用的索引")])])]),t._v(" "),a("li",[t._v("unique_subquery\n"),a("ul",[a("li",[t._v("eq_ref的IN查询")])])]),t._v(" "),a("li",[t._v("index_subquery\n"),a("ul",[a("li",[t._v("ref的In查询")])])]),t._v(" "),a("li",[t._v("range\n"),a("ul",[a("li",[t._v("使用索引选择行，仅检索给定范围内的行，如 "),a("code",[t._v("where create_time > '2020-12-01'")])]),t._v(" "),a("li",[a("code",[t._v("range")]),t._v("当一个键列使用任何的相比于恒定可使用 "),a("code",[t._v("=")]),t._v("， "),a("code",[t._v("<>")]),t._v("，"),a("code",[t._v(">")]),t._v("，"),a("code",[t._v(">=")]),t._v(","),a("code",[t._v("<")]),t._v("，"),a("code",[t._v("<=")]),t._v(","),a("code",[t._v("IS NULL")]),t._v(","),a("code",[t._v("<=>")]),t._v(","),a("code",[t._v("BETWEEN")]),t._v(","),a("code",[t._v("LIKE")]),t._v(","),a("code",[t._v("IN()")])])])]),t._v(" "),a("li",[t._v("index\n"),a("ul",[a("li",[t._v("扫描索引树。当查询仅使用属于单个索引一部分的列时，MySQL可以使用此连接类型。")])])]),t._v(" "),a("li",[t._v("ALL\n"),a("ul",[a("li",[t._v("没有索引，全表扫描")])])])]),t._v(" "),a("h2",{attrs:{id:"查看死锁"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看死锁"}},[t._v("#")]),t._v(" 查看死锁")]),t._v(" "),a("ul",[a("li",[a("p",[a("code",[t._v("show engine innodb status")]),t._v("查看innodb状态")])]),t._v(" "),a("li",[a("p",[t._v("查找以下内容")]),t._v(" "),a("div",{staticClass:"language-log extra-class"},[a("pre",{pre:!0,attrs:{class:"language-log"}},[a("code",[a("span",{pre:!0,attrs:{class:"token separator comment"}},[t._v("------------------------")]),t._v("\nLETEST DETECTED DEADLOCK\n"),a("span",{pre:!0,attrs:{class:"token separator comment"}},[t._v("------------------------")]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[t._v("查看下面的日志，寻找死锁导致的sql")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);